<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common">
	<select id="main" resultType="hashmap" >
		<![CDATA[
		SELECT /*+INDEX_DESC(CAFEINFO C, OWNER_GOODSREG O, REVIEW R) */ C.CAFE_IDX, C.CAFE_NAME,C.CAFE_LOCATION, I.CP_STORED_FILE_NAME,
		 MIN(O.GOODSREG_PRICE), count(R.V_C_IDX) B, avg(R.V_star) A
		from CAFEINFO C left join OWNER_GOODSREG O 
		ON C.CAFE_IDX = O.GOODSREG_CAFE_IDX
		left outer join REVIEW R
		ON O.GOODSREG_IDX = R.V_O_IDX
		left outer join cafephoto I 
		on I.cp_board_idx = c.cafe_idx
		where I.cp_board_type='cafeInfo'
		group by C.CAFE_IDX, C.CAFE_NAME,C.CAFE_LOCATION,
		 I.CP_STORED_FILE_NAME
		]]>
	</select>
	<insert id="join">
		insert
		into MEMBERS(m_id, m_name, m_email, m_pw, m_cellphone, m_type <if test="m_type == 1">, m_own_num</if>)
		values (#{m_id}, #{m_name}, #{m_email}, #{m_pw}, ${m_cellphone}, ${m_type} <if test="m_type == 1">, ${m_own_num}</if>)
	</insert>
	<select id="getUserInfo" resultType="hashmap">
		select m_id, m_pw, m_name, m_type from MEMBERS where m_id = #{m_id}
	</select>
</mapper>